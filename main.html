<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elephanto's Games - Who's That Pokémon?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cartograph CF', 'sans-serif'],
                    },
                    colors: {
                        md: {
                            bg: '#0F0D13',       // Very dark purple/black background
                            surface: '#201A29',  // Surface card color
                            surface2: '#2F263C', // Lighter surface
                            primary: '#D0BCFF',  // M3 Purple 80
                            onPrimary: '#381E72',
                            secondary: '#4FDD77', // Vibrant Green
                            onSecondary: '#003915',
                            tertiary: '#B6C4FF',
                            error: '#FFB4AB',
                        }
                    },
                    boxShadow: {
                        'glow': '0 0 20px rgba(79, 221, 119, 0.3)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0F0D13;
            color: #E6E1E5;
            -webkit-tap-highlight-color: transparent;
        }

        /* Android 16/Material 3 Styling Adjustments */
        .m3-card {
            border-radius: 28px;
            background-color: #201A29;
            transition: transform 0.3s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .m3-input {
            border-radius: 9999px; /* Pill shape */
            background-color: #2F263C;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        .m3-input:focus {
            border-color: #D0BCFF;
            background-color: #362F42;
            outline: none;
        }

        .m3-btn {
            border-radius: 9999px;
            font-weight: 500;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 0.875rem;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }
        .m3-btn:active {
            transform: scale(0.96);
        }

        /* Silhouette Logic */
        .silhouette {
            filter: brightness(0) contrast(0);
            transition: filter 0.5s ease-in-out;
        }
        .revealed {
            filter: brightness(1) contrast(1) drop-shadow(0 10px 15px rgba(0,0,0,0.5));
        }

        /* Loading Spinner */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #D0BCFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Input Shake Animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.4s ease-in-out;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Header -->
    <header class="w-full max-w-md flex justify-between items-center mb-6 px-2">
        <div>
            <h1 class="text-2xl font-bold text-md-primary tracking-tight">Elephanto's Games</h1>
            <p class="text-sm text-gray-400">Guess the Pokémon!</p>
        </div>
        <div class="bg-md-surface2 px-4 py-2 rounded-full flex items-center gap-2 border border-white/10">
            <span class="text-md-secondary text-sm font-bold uppercase">Streak</span>
            <span id="streak-counter" class="text-white font-bold text-lg">0</span>
        </div>
    </header>

    <!-- Main Game Card -->
    <main class="w-full max-w-md m3-card p-6 shadow-2xl relative overflow-hidden flex flex-col items-center min-h-[550px] justify-between">

        <!-- Decorative Background Elements -->
        <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-md-primary/10 to-transparent pointer-events-none"></div>
        <div class="absolute -right-10 top-10 w-32 h-32 bg-md-secondary/10 rounded-full blur-2xl pointer-events-none"></div>

        <!-- Image Area -->
        <div class="relative w-64 h-64 flex items-center justify-center mt-4">
            <!-- Loading State -->
            <div id="loader" class="absolute inset-0 flex items-center justify-center z-10">
                <span class="loader"></span>
            </div>

            <!-- The Pokemon Image -->
            <img id="poke-img"
                 src=""
                 alt="Who is that Pokemon?"
                 class="w-full h-full object-contain silhouette opacity-0 transition-opacity duration-300 z-20"
                 draggable="false">
        </div>

        <!-- Info Chips (Generation & Type) - Initially Hidden -->
        <div id="info-container" class="flex flex-wrap gap-2 justify-center mt-2 opacity-0 transition-opacity duration-500 h-0 overflow-hidden">
             <!-- Injected via JS -->
        </div>

        <!-- Game Interface -->
        <div class="w-full mt-4 flex flex-col gap-4 z-30">

            <!-- Feedback Message -->
            <div id="feedback" class="h-8 text-center font-bold text-lg tracking-wide opacity-0 transition-opacity">
                &nbsp;
            </div>

            <!-- Input Form -->
            <div id="input-container" class="relative group">
                <input type="text"
                       id="guess-input"
                       placeholder="What is this Pokémon?"
                       class="w-full p-4 pl-6 text-lg text-white m3-input placeholder-gray-500 shadow-lg focus:shadow-md-primary/20"
                       autocomplete="off">

                <!-- Submit Arrow -->
                <button id="submit-btn" class="absolute right-2 top-2 bottom-2 bg-md-primary text-md-onPrimary rounded-full w-12 flex items-center justify-center hover:bg-white transition-colors" onclick="handleGuess()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                    </svg>
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-2 gap-3 mt-2">
                <button onclick="revealPokemon(false)" class="m3-btn py-3 bg-md-surface2 text-gray-300 hover:bg-white/10 border border-white/5">
                    I don't know
                </button>
                <button id="next-btn" onclick="initGame()" class="m3-btn py-3 bg-md-secondary text-md-onSecondary shadow-glow opacity-50 pointer-events-none" disabled>
                    Next
                </button>
            </div>
        </div>
    </main>

    <!-- Credits -->
    <footer class="mt-8 text-center text-gray-600 text-xs">
        Powered by PokeAPI
    </footer>

    <script>
        // Game State
        let currentPokemon = null;
        let streak = 0;
        let isRevealed = false;

        // Type Colors Map
        const TYPE_COLORS = {
            normal: '#A8A878',
            fire: '#F08030',
            water: '#6890F0',
            electric: '#F8D030',
            grass: '#78C850',
            ice: '#98D8D8',
            fighting: '#C03028',
            poison: '#A040A0',
            ground: '#E0C068',
            flying: '#A890F0',
            psychic: '#F85888',
            bug: '#A8B820',
            rock: '#B8A038',
            ghost: '#705898',
            dragon: '#7038F8',
            steel: '#B8B8D0',
            fairy: '#EE99AC'
        };

        // DOM Elements
        const els = {
            img: document.getElementById('poke-img'),
            loader: document.getElementById('loader'),
            input: document.getElementById('guess-input'),
            feedback: document.getElementById('feedback'),
            streak: document.getElementById('streak-counter'),
            nextBtn: document.getElementById('next-btn'),
            inputContainer: document.getElementById('input-container'),
            submitBtn: document.getElementById('submit-btn'),
            infoContainer: document.getElementById('info-container')
        };

        // Initialize on Load
        window.addEventListener('DOMContentLoaded', () => {
            // Load streak from local storage
            const savedStreak = localStorage.getItem('pokemonStreak');
            if (savedStreak) {
                streak = parseInt(savedStreak, 10);
                els.streak.textContent = streak;
            }
            initGame();
        });

        // Input Listener for "Enter" key
        els.input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleGuess();
        });

        async function initGame() {
            // Reset UI
            isRevealed = false;
            els.input.value = '';
            els.input.disabled = false;
            els.input.focus();
            els.feedback.style.opacity = '0';

            // Reset Info Chips
            els.infoContainer.style.opacity = '0';
            els.infoContainer.style.height = '0';
            els.infoContainer.innerHTML = '';

            els.img.classList.add('opacity-0');
            els.img.classList.remove('revealed');
            els.img.classList.add('silhouette');
            els.loader.style.display = 'flex';

            // Disable Next button until round over
            els.nextBtn.disabled = true;
            els.nextBtn.classList.add('opacity-50', 'pointer-events-none');
            els.submitBtn.classList.remove('opacity-50', 'pointer-events-none');

            // 1. Generate Random ID (Gen 1-3: 1 to 386 for nostalgia & distinct shapes)
            const randomId = Math.floor(Math.random() * 386) + 1;

            try {
                // 2. Fetch Data (Fetch both Pokemon and Species data in parallel)
                const [pokemonRes, speciesRes] = await Promise.all([
                    fetch(`https://pokeapi.co/api/v2/pokemon/${randomId}`),
                    fetch(`https://pokeapi.co/api/v2/pokemon-species/${randomId}`)
                ]);

                const pokemonData = await pokemonRes.json();
                const speciesData = await speciesRes.json();

                // 3. Store current Mon data
                currentPokemon = {
                    name: pokemonData.name,
                    image: pokemonData.sprites.other['official-artwork'].front_default,
                    types: pokemonData.types.map(t => t.type.name),
                    generation: speciesData.generation.name
                };

                // 4. Preload Image
                const imgLoader = new Image();
                imgLoader.src = currentPokemon.image;
                imgLoader.onload = () => {
                    els.img.src = currentPokemon.image;
                    els.loader.style.display = 'none';
                    els.img.classList.remove('opacity-0');
                };

            } catch (error) {
                console.error("Failed to catch Pokemon", error);
                els.feedback.textContent = "Error fetching Pokémon!";
                els.feedback.style.color = '#FFB4AB';
                els.feedback.style.opacity = '1';
            }
        }

        function handleGuess() {
            if (isRevealed || !currentPokemon) return;

            const userGuess = els.input.value.trim().toLowerCase();
            const actualName = currentPokemon.name;

            const cleanUserGuess = userGuess.replace(/[\.\s]/g, '-');
            const cleanActualName = actualName;

            const isMatch = (cleanUserGuess === cleanActualName) ||
                            (cleanUserGuess === cleanActualName.replace(/-/g, '')) ||
                            (userGuess === cleanActualName.replace(/-/g, ' '));

            if (isMatch) {
                winRound();
            } else {
                shakeInput();
                els.input.value = '';
                els.input.placeholder = "Try again!";
            }
        }

        function winRound() {
            els.feedback.textContent = `Correct! It's ${formatName(currentPokemon.name)}!`;
            els.feedback.style.color = '#4FDD77'; // Green
            els.feedback.style.opacity = '1';
            streak++;
            updateStreak();
            revealPokemon(true);
        }

        function revealPokemon(isWin) {
            isRevealed = true;
            els.img.classList.remove('silhouette');
            els.img.classList.add('revealed');

            els.input.disabled = true;
            els.submitBtn.classList.add('opacity-50', 'pointer-events-none');

            // Enable Next Button
            els.nextBtn.disabled = false;
            els.nextBtn.classList.remove('opacity-50', 'pointer-events-none');
            els.nextBtn.focus();

            // Populate Info Chips
            renderInfoChips();

            if (!isWin) {
                streak = 0;
                updateStreak();
                els.feedback.innerHTML = `It was <span class="text-md-primary">${formatName(currentPokemon.name)}</span>!`;
                els.feedback.style.color = '#E6E1E5';
                els.feedback.style.opacity = '1';
            }
        }

        function renderInfoChips() {
            // Clear existing
            els.infoContainer.innerHTML = '';

            // Create Generation Chip (Default Style)
            const genName = currentPokemon.generation.split('-')[1].toUpperCase(); // "generation-i" -> "I"
            const genChip = createChip(`GEN ${genName}`, null);
            els.infoContainer.appendChild(genChip);

            // Create Type Chips (Colored Style)
            currentPokemon.types.forEach(type => {
                const color = TYPE_COLORS[type] || '#777';
                const typeChip = createChip(type, color);
                els.infoContainer.appendChild(typeChip);
            });

            // Show container
            els.infoContainer.style.height = 'auto';
            els.infoContainer.style.opacity = '1';
        }

        function createChip(text, colorHex) {
            const span = document.createElement('span');

            if (colorHex) {
                // Colored Type Chip
                span.className = `px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm text-white border border-white/20`;
                span.style.backgroundColor = colorHex;
                span.style.textShadow = '0 1px 2px rgba(0,0,0,0.3)';
            } else {
                // Default Gen Chip
                span.className = `px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border shadow-sm bg-md-surface2 text-md-tertiary border-md-tertiary/20`;
            }

            span.textContent = text;
            return span;
        }

        function shakeInput() {
            els.inputContainer.classList.add('shake');
            els.inputContainer.style.borderColor = '#FFB4AB'; // Error color
            setTimeout(() => {
                els.inputContainer.classList.remove('shake');
                els.inputContainer.style.borderColor = 'transparent';
            }, 400);
        }

        function updateStreak() {
            els.streak.textContent = streak;
            localStorage.setItem('pokemonStreak', streak); // Save to local storage
            els.streak.parentElement.classList.add('scale-110');
            setTimeout(() => els.streak.parentElement.classList.remove('scale-110'), 200);
        }

        function formatName(name) {
            return name
                .split('-')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }
    </script>
</body>
</html>
